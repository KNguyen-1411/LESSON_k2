--Bài Thi --Họ Tên: Nguyễn Đình Khánh Nguyên --MSV: 23T1080051   --Câu 3: Select v.MaVatTu From VatTu AS v Where v.TenVatTu Like N'%Bóng đèn%' 	And v.NuocSuanXuat=N'Việt Nam'  --dapan 	SELECT  MaVatTu, TenVatTu, NuocSanXuat 	FROM    VatTu  	WHERE   TenVatTu LIKE N'%Bóng đèn%' AND NuocSanXuat = N'Việt Nam'  --Câu 4: Select distinct p.NguoiLapPhieu From PhieuXuatVatTu AS p Where Year(p.NgayLapPhieu)=2023 	and MONTH(p.NgayLapPhieu)=5 	and Day(p.NgayLapPhieu) between 1 and 15  	--dapan 	SELECT  DISTINCT NguoiLapPhieu 	FROM    PhieuXuatVatTu 	WHERE   NgayLapPhieu BETWEEN '2023/05/01' AND '2023/05/15'  --Câu 5: Select * From VatTu Where NuocSuanXuat in (N'Việt Nam',N'Nhật',N'Pháp',N'Đức') 	 	--dapan 	SELECT  MaVatTu, TenVatTu, NuocSanXuat 	FROM    VatTu  	WHERE   NuocSanXuat IN (N'Việt Nam', N'Nhật', N'Đức', N'Pháp') --Câu 6: Select * From VatTu Where MaVatTu=N'P003'  	--dapan 	SELECT  * 	FROM    VatTu AS vt 			JOIN ChiTietPhieuXuatVatTu AS ct ON vt.MaVatTu = ct.MaVatTu 	WHERE   ct.SoPhieu = 'P003' --Câu 7: Select p.NguoiLapPhieu, 	count(p.SoPhieu) AS SoPhieu From PhieuXuatVatTu as p Where Year(p.NgayLapPhieu)=2023 Group by p.NguoiLapPhieu 	--dapan 	SELECT  NguoiLapPhieu, COUNT(SoPhieu) AS SoLuongPhieu 	FROM    PhieuXuatVatTu 	WHERE   YEAR(NgayLapPhieu) = 2023 	GROUP BY NguoiLapPhieu  --Câu 8: Select v.MaVatTu,v.TenVatTu,v.NuocSuanXuat, 	Sum(Case  			When c.SoLuong Is Null Then 0 			else c.SoLuong 		end) From VatTu as v 	Left Join ChiTietPhieuXuatVatTu as c 		on v.MaVatTu=c.MaVatTu Group by v.MaVatTu,v.TenVatTu,v.NuocSuanXuat   SELECT  vt.MaVatTu, vt.TenVatTu, ISNULL(SUM(ct.SoLuong),0) AS TongSoLuongXuat FROM	VatTu AS vt 	    LEFT JOIN ChiTietPhieuXuatVatTu AS ct ON vt.MaVatTu = ct.MaVatTu GROUP BY vt.MaVatTu, vt.TenVatTu --Câu 9: --Cách 1: dùng truy vấn con SELECT	SoPhieu, NgayLapPhieu FROM	PhieuXuatVatTu WHERE	NguoiLapPhieu = (SELECT NguoiLapPhieu FROM PhieuXuatVatTu WHERE SoPhieu = 'P001')  --Cách 2: dùng phép tự nối SELECT  p2.SoPhieu, p2.NgayLapPhieu FROM    PhieuXuatVatTu AS p1         JOIN PhieuXuatVatTu AS p2 ON p1.NguoiLapPhieu = p2.NguoiLapPhieu WHERE   p1.SoPhieu = 'P001'   --Câu 10: SELECT v.MaVatTu, v.TenVatTu, v.NuocSuanXuat,  	SUM(ISNULL(c.SoLuong, 0)) AS Tong FROM VatTu AS v LEFT JOIN ChiTietPhieuXuatVatTu AS c ON v.MaVatTu = c.MaVatTu GROUP BY v.MaVatTu, v.TenVatTu, v.NuocSuanXuat HAVING SUM(ISNULL(c.SoLuong, 0)) = ( 	SELECT MAX(T.SL) 	FROM ( 		SELECT v.MaVatTu,  		SUM(ISNULL(c.SoLuong, 0)) AS SL 		FROM VatTu AS v 		LEFT JOIN ChiTietPhieuXuatVatTu AS c ON v.MaVatTu = c.MaVatTu 		GROUP BY v.MaVatTu 	) AS T ) --Cách 1: SELECT  vt.MaVatTu, vt.TenVatTu, SUM(ct.SoLuong) AS TongSoLuongXuat FROM    VatTu AS vt         JOIN ChiTietPhieuXuatVatTu AS ct ON vt.MaVatTu = ct.MaVatTu GROUP BY vt.MaVatTu, vt.TenVatTu HAVING SUM(ct.SoLuong) =          (                SELECT TOP(1) SUM(SoLuong)                FROM ChiTietPhieuXuatVatTu                GROUP BY MaVatTu                 ORDER BY 1 DESC         )  --Cách 2: SELECT  vt.MaVatTu, vt.TenVatTu, SUM(ct.SoLuong) AS TongSoLuongXuat FROM    VatTu AS vt         JOIN ChiTietPhieuXuatVatTu AS ct ON vt.MaVatTu = ct.MaVatTu GROUP BY vt.MaVatTu, vt.TenVatTu HAVING SUM(ct.SoLuong) >= ALL          (                SELECT SUM(SoLuong)                FROM ChiTietPhieuXuatVatTu                GROUP BY MaVatTu                         ) --Câu 11: UPDATE ChiTietPhieuXuatVatTu SET SoLuong = SoLuong * 2 WHERE SoPhieu IN (   SELECT SoPhieu   FROM PhieuXuatVatTu   WHERE CONVERT(date, NgayLapPhieu) = '2023-05-15' )  --Câu 12: 	--Thêm Cột ALTER TABLE VatTu ADD TongVatTu INT; 	--Cập Nhật Giá Trị UPDATE VatTu SET TongVatTu = (   SELECT SUM(ISNULL(c.SoLuong, 0))   FROM VatTu AS v   LEFT JOIN ChiTietPhieuXuatVatTu AS c   ON v.MaVatTu = c.MaVatTu   WHERE v.MaVatTu = VatTu.MaVatTu   GROUP BY v.MaVatTu ) 